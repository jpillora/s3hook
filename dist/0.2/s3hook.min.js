// S3 Hook - v0.2.1 - https://github.com/jpillora/s3hook
// Jaime Pillora <dev@jpillora.com> - MIT Copyright 2013
!function(a,b){function c(a){if(c.parser)return c.parser.parseFromString(a,"text/xml");var b=new ActiveXObject("Microsoft.XMLDOM");return b.async=!1,b.loadXML(a),b}function d(a){var b={};if(1==a.nodeType){if(a.attributes.length>0){b["@attributes"]={};for(var c=0;c<a.attributes.length;c++)b["@attributes"][a.attributes[c].nodeName]=a.attributes[c].nodeValue}}else 3==a.nodeType&&(b=a.nodeValue);if(a.hasChildNodes())for(var e=0;e<a.childNodes.length;e++)if("undefined"==typeof b[a.childNodes[e].nodeName])b[a.childNodes[e].nodeName]=d(a.childNodes[e]);else{if("undefined"==typeof b[a.childNodes[e].nodeName].length){var f=b[a.childNodes[e].nodeName];b[a.childNodes[e].nodeName]=[],b[a.childNodes[e].nodeName].push(f)}b[a.childNodes[e].nodeName].push(d(a.childNodes[e]))}var g=!0;for(var h in b)"#text"!==h&&(g=!1);return g?b["#text"]:b}var e={hex:"0123456789abcdef",utf8:"\0",utf8_table:{},ascii:"\0\b	\n\f\r !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~Â€ÂÂ‚ÂƒÂ„Â…Â†Â‡ÂˆÂ‰ÂŠÂ‹ÂŒÂÂÂÂÂ‘Â’Â“Â”Â•Â–Â—Â˜Â™ÂšÂ›ÂœÂÂÂŸÂ Â¡Â¢Â£Â¤Â¥Â¦Â§Â¨Â©ÂªÂ«Â¬Â­Â®Â¯Â°Â±Â²Â³Â´ÂµÂ¶Â·Â¸Â¹ÂºÂ»Â¼Â½Â¾Â¿Ã€ÃÃ‚ÃƒÃ„Ã…Ã†Ã‡ÃˆÃ‰ÃŠÃ‹ÃŒÃÃÃÃÃ‘Ã’Ã“Ã”Ã•Ã–Ã—Ã˜Ã™ÃšÃ›ÃœÃÃÃŸÃ Ã¡Ã¢Ã£Ã¤Ã¥Ã¦Ã§Ã¨Ã©ÃªÃ«Ã¬Ã­Ã®Ã¯Ã°Ã±Ã²Ã³Ã´ÃµÃ¶Ã·Ã¸Ã¹ÃºÃ»Ã¼Ã½Ã¾Ã¿",ascii_table:{0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,"\0":0,"":1,"":2,"":3,"":4,"":5,"":6,"":7,"\b":8,"	":9,"\n":10,"":11,"\f":12,"\r":13,"":14,"":15,"":16,"":17,"":18,"":19,"":20,"":21,"":22,"":23,"":24,"":25,"":26,"":27,"":28,"":29,"":30,"":31," ":32,"!":33,'"':34,"#":35,$:36,"%":37,"&":38,"'":39,"(":40,")":41,"*":42,"+":43,",":44,"-":45,".":46,"/":47,":":58,";":59,"<":60,"=":61,">":62,"?":63,"@":64,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,"[":91,"\\":92,"]":93,"^":94,_:95,"`":96,a:97,b:98,c:99,d:100,e:101,f:102,g:103,h:104,i:105,j:106,k:107,l:108,m:109,n:110,o:111,p:112,q:113,r:114,s:115,t:116,u:117,v:118,w:119,x:120,y:121,z:122,"{":123,"|":124,"}":125,"~":126,"":127,"Â€":128,"Â":129,"Â‚":130,"Âƒ":131,"Â„":132,"Â…":133,"Â†":134,"Â‡":135,"Âˆ":136,"Â‰":137,"ÂŠ":138,"Â‹":139,"ÂŒ":140,"Â":141,"Â":142,"Â":143,"Â":144,"Â‘":145,"Â’":146,"Â“":147,"Â”":148,"Â•":149,"Â–":150,"Â—":151,"Â˜":152,"Â™":153,"Âš":154,"Â›":155,"Âœ":156,"Â":157,"Â":158,"ÂŸ":159,"Â ":160,"Â¡":161,"Â¢":162,"Â£":163,"Â¤":164,"Â¥":165,"Â¦":166,"Â§":167,"Â¨":168,"Â©":169,"Âª":170,"Â«":171,"Â¬":172,"Â­":173,"Â®":174,"Â¯":175,"Â°":176,"Â±":177,"Â²":178,"Â³":179,"Â´":180,"Âµ":181,"Â¶":182,"Â·":183,"Â¸":184,"Â¹":185,"Âº":186,"Â»":187,"Â¼":188,"Â½":189,"Â¾":190,"Â¿":191,"Ã€":192,"Ã":193,"Ã‚":194,"Ãƒ":195,"Ã„":196,"Ã…":197,"Ã†":198,"Ã‡":199,"Ãˆ":200,"Ã‰":201,"ÃŠ":202,"Ã‹":203,"ÃŒ":204,"Ã":205,"Ã":206,"Ã":207,"Ã":208,"Ã‘":209,"Ã’":210,"Ã“":211,"Ã”":212,"Ã•":213,"Ã–":214,"Ã—":215,"Ã˜":216,"Ã™":217,"Ãš":218,"Ã›":219,"Ãœ":220,"Ã":221,"Ã":222,"ÃŸ":223,"Ã ":224,"Ã¡":225,"Ã¢":226,"Ã£":227,"Ã¤":228,"Ã¥":229,"Ã¦":230,"Ã§":231,"Ã¨":232,"Ã©":233,"Ãª":234,"Ã«":235,"Ã¬":236,"Ã­":237,"Ã®":238,"Ã¯":239,"Ã°":240,"Ã±":241,"Ã²":242,"Ã³":243,"Ã´":244,"Ãµ":245,"Ã¶":246,"Ã·":247,"Ã¸":248,"Ã¹":249,"Ãº":250,"Ã»":251,"Ã¼":252,"Ã½":253,"Ã¾":254,"Ã¿":255},base64:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",_searchCharTable:function(a,b){for(var a=a+"",b=b+"",c=0,d=b.length,e=0,f="";e!=(e=c+d>>1);){if(f=(e>>>=0)<b.length?b[e]:"",a==f)return e;a>f?c=e:d=e}return 0},b2h:function(a){var b=this.hex+"",c=15&a>>4,d=15&a;return((c>>>=0)<b.length?b[c]:"0")+((d>>>=0)<b.length?b[d]:"0")},b64c:function(a){return"+"==a||"-"==a?62:"/"==a||"_"==a?63:a>="0"&&"9">=a?+a+52:this._searchCharTable(a,this.base64)},charCode:function(a){var b=this.ascii_table;return 1==a.length&&"Ã¿">=a?b[a]:this._searchCharTable(a,this.utf8)},a2b:function(a){var b=this.ascii_table;return 1==a.length&&"Ã¿">=a?b[a]:0},b2a:function(a){var b=this.ascii+"";return(a>>>=0)<b.length?b[a]:"\0"},fromCharCode:function(a){var b=this.ascii+"",c=this.utf8+"";return(a>>>=0)<b.length?b[a]:(a>>>=0)<c.length?c[a]:"\0"},astr2hstr:function(a){var b="",c=0,a=a+"";for(c=0;c<a.length;c++)b+=this.b2h(this.a2b(a[c]));return b},hstr2astr:function(a){var b=0,c=0,d="",e="",f=this.ascii+"",a=a+"";for(b=0;b<a.length;b++)1&b?(c=+("0x"+d+a[b]),e+=(c>>>=0)<f.length?f[c]:"\0"):d=a[b];return e},utf8_encode:function(a){var b="",c=0,d=0,e="",f=[0,0,0,0],g=[0,0];for(c=0;c<a.length;c++){if(d=this.a2b(e=a[c]),0!=g[0]){if(128>d||d>191){g=[0,0];continue}if(f[3&g[1]+1-g[0]--]=d,g[0])continue;b+=this.fromCharCode(1==g[1]?(31&f[0])<<6|63&f[1]:(15&f[0])<<12|(63&f[1])<<6|63&f[2])}f[0]=d,128>d?b+=e:d>191&&224>d?g=[1,1]:d>=224&&240>d&&(g=[2,2])}return b},utf8_decode:function(a){var b="",c=0,d=0,a=a+"",e=this.b2a(0);for(c=0;c<a.length;c++)d=this.charCode(e=a[c]),b+=128>d?e:2048>d?this.b2a(192|d>>6)+this.b2a(128|63&d):this.b2a(224|d>>12)+this.b2a(128|63&d>>6)+this.b2a(128|63&d);return b},base64_encode:function(a){return this._base64_encode(a,!1)},base64_urlencode:function(a){return this._base64_encode(a,!0)},_base64_encode:function(a,b){var c="",d=0,e=0,a=a+"",f=[0,0],g=b?"":"=",h=this.base64+"0123456789"+(b?"-_":"+/"),i=function(a){return(a>>>=0)<h.length?h[a]:"A"};for(d=0;d<a.length;d++)e=this.a2b(a[d]),2==d%3?(e+=(f[1]<<8)+(f[0]<<16),c+=i(63&e>>>18),c+=i(63&e>>>12),c+=i(63&e>>>6),c+=i(63&e),f=[0,0]):f[1&d%3]=e;return 0!=d%3&&(e=(f[1]<<8)+(f[0]<<16),c+=i(63&e>>>18),c+=i(63&e>>>12),c+=2==d%3?i(63&e>>>6):g,c+=g),c},base64_decode:function(a){var a=a+"",b="",c=[0,0,0,0],d=0,e="",f=0;for(0!=(3&a.length)&&(a+="="),d=0;d<a.length&&"="!=(e=a[d]);d++)f=this.b64c(e),3==(3&d)?(f+=(c[2]<<6)+(c[1]<<12)+(c[0]<<18),b+=this.b2a(255&f>>>16),b+=this.b2a(255&f>>>8),b+=this.b2a(255&f),c=[0,0,0,0]):c[3&d%4]=f;return(3&d)>1&&(f=(c[2]<<6)+(c[1]<<12)+(c[0]<<18),b+=this.b2a(255&f>>>16),3==(3&d)&&(b+=this.b2a(255&f>>>8))),b}},f=function(){var a={name:"sha1",identifier:"2b0e03021a",size:20,block:64,hash:function(a){for(var b=(a+="Â€").length,c=b>>6,d=63&b,f="",g=0,h=0,i=[1732584193,4023233417,2562383102,271733878,3285377520],j=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];56!=d++;)a+="\0",64==d&&(c++,d=0);for(a+="\0\0\0\0",d=3,b=8*(b-1);d>=0;d--)a+=e.b2a(255&b>>8*d);for(g=0;g<a.length;g++)h=(h<<8)+e.a2b(a[g]),3==(3&g)&&(j[15&g>>2]=h,h=0),63==(63&g)&&this._round(i,j);for(g=0;g<i.length;g++)for(h=3;h>=0;h--)f+=e.b2a(255&i[g]>>8*h);return f},_round:function(a,b){var c=a[0],d=a[1],e=a[2],f=a[3],g=a[4],h=0,i=[1518500249,1859775393,2400959708,3395469782],j=function(a,b){return b<<a|b>>>32-a},k=0,l=function(a,b,c,d){return 20>a?b&c|~b&d:40>a?b^c^d:60>a?b&c|b&d|c&d:b^c^d};for(h=0;80>h;h++)h>=16&&(b[127&h]=j(1,b[127&h-3]^b[127&h-8]^b[127&h-14]^b[127&h-16])),k=0|j(5,c)+l(h,d,e,f)+g+b[127&h]+i[3&h/20],g=f,f=e,e=j(30,d),d=c,c=k;a[0]=0|a[0]+c,a[1]=0|a[1]+d,a[2]=0|a[2]+e,a[3]=0|a[3]+f,a[4]=0|a[4]+g}},b={name:"sha-256",identifier:"608648016503040201",size:32,block:64,key:[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],hash:function(a){for(var a=a+"Â€",b=a.length,c=b>>6,d=63&b,f="",g=0,h=0,i=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],j=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];56!=d++;)a+="\0",64==d&&(c++,d=0);for(a+="\0\0\0\0",d=3,b=8*(b-1);d>=0;d--)a+=e.b2a(255&b>>8*d);for(g=0;g<a.length;g++)h=(h<<8)+e.a2b(a[g]),3==(3&g)&&(j[15&g>>2]=h,h=0),63==(63&g)&&this._round(i,j);for(g=0;g<i.length;g++)for(h=3;h>=0;h--)f+=e.b2a(255&i[g]>>8*h);return f},_round:function(a,b){var c=a[0],d=a[1],e=a[2],f=a[3],g=a[4],h=a[5],i=a[6],j=a[7],k=0,l=0,m=0,n=0;for(k=0;64>k;k++)16>k?n=b[15&k]:(l=b[15&k+1],m=b[15&k+14],n=b[15&k]=0|(l>>>7^l>>>18^l>>>3^l<<25^l<<14)+(m>>>17^m>>>19^m>>>10^m<<15^m<<13)+b[15&k]+b[15&k+9]),n=n+j+(g>>>6^g>>>11^g>>>25^g<<26^g<<21^g<<7)+(i^g&(h^i))+this.key[63&k],j=i,i=h,h=g,g=0|f+n,f=e,e=d,d=c,c=0|n+(d&e^f&(d^e))+(d>>>2^d>>>13^d>>>22^d<<30^d<<19^d<<10);a[0]=0|a[0]+c,a[1]=0|a[1]+d,a[2]=0|a[2]+e,a[3]=0|a[3]+f,a[4]=0|a[4]+g,a[5]=0|a[5]+h,a[6]=0|a[6]+i,a[7]=0|a[7]+j}};return{sha256:b,sha1:a,SHA256:function(a){return e.astr2hstr(this.sha256.hash(a))},SHA1:function(a){return e.astr2hstr(this.sha1.hash(a))},hmac_hash:b,HMAC:function(a,b){var a=a+"",b=b+"",c=0,d=this.hmac_hash,f=0,g="",h="";for(a.length>d.block&&(a=d.hash(a));a.length<d.block;)a+="\0";for(c=0;c<a.length;c++)f=e.a2b(a[c]),g+=e.b2a(54^f),h+=e.b2a(92^f);return e.astr2hstr(d.hash(h+d.hash(g+b)))}}}();!function(a,b){!function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o=[].slice;e="before",d="after",h="readyState",g="Invalid number or parameters. Please see API documentation.",(n=Array.prototype).indexOf||(n.indexOf=function(a){var b,c,d,e;for(b=d=0,e=this.length;e>d;b=++d)if(c=this[b],c===a)return b;return-1}),f=function(a){var b,d,e;return d={},e=function(a){return d[a]||[]},b={listeners:function(a){return Array.prototype.slice.call(e(a))},on:function(a,b,f){d[a]=e(a),d[a].indexOf(b)>=0||(f=f===c?d[a].length:f,d[a].splice(f,0,b))},off:function(a,b){var c;c=e(a).indexOf(b),-1!==c&&e(a).splice(c,1)},fire:function(){var b,c,d,f,g,h;for(c=arguments[0],b=2<=arguments.length?o.call(arguments,1):[],h=e(c),f=0,g=h.length;g>f;f++)d=h[f],d.apply(a,b)}}},l=f(),m={},m[e]=function(a,b){return l.on(e,a,b)},m[d]=function(a,b){return l.on(d,a,b)},i=function(a,b){var c,d,e,f,g,h;switch(null==b&&(b={}),typeof a){case"object":d=[];for(e in a)f=a[e],d.push(""+e+":	"+f);return d.join("\n");case"string":for(d=a.split("\n"),g=0,h=d.length;h>g;g++)c=d[g],/([^:]+):\s*(.+)/.test(c)&&(b[RegExp.$1]||(b[RegExp.$1]=RegExp.$2));return b}},m.headers=i,k=function(b){var c;c=a[b],c&&(a[b]=function(a){return"string"!=typeof a||/\.XMLHTTP/.test(a)?j(new c(a)):void 0})},k("ActiveXObject"),k("XMLHttpRequest"),j=function(a){var b,j,k,m,n,o,p,q,r,s,t,u,v,w,x,y,z;if(0===l.listeners(e).length&&0===l.listeners(d).length)return a;for(v=!1,s={headers:{}},t=null,w=f(),r=function(){p.status=t.status,p.statusText=t.statusText,t.headers||(t.headers={})},q=function(){p.responseType=t.type||"",p.response=t.data||null,p.responseText=t.text||t.data||"",p.responseXML=t.xml||null},k=function(){var b,c,d,e;t.status=a.status,t.statusText=a.statusText,d=i(a.getAllResponseHeaders()),e=[];for(b in d)c=d[b],t.headers[b]?e.push(void 0):e.push(t.headers[b]=c);return e},j=function(){return t.type=a.responseType,t.text=a.responseText,t.data=a.response||t.text,t.xml=a.responseXML},m=0,u=function(a){var b,c,e;return o(),b=function(){for(;a>m&&4>m;)p[h]=++m,2===m&&r(),4===m&&q(),w.fire("readystatechange"),4===m&&w.fire("load")},4>a?b():(c=l.listeners(d),e=function(){var a;if(!c.length)return b();if(a=c.shift(),2===a.length)return a(s,t),e();if(3===a.length)return a(s,t,e);throw g},e(),void 0)},b=function(b){var c,d,e;c={};for(d in b)e=b[d],c[d]=e===a?p:e;return c},o=function(){var b,d,e,f,g;for(g=["timeout"],e=0,f=g.length;f>e;e++)d=g[e],a[d]&&s[d]===c&&(s[d]=a[d]);for(d in p)b=p[d],"function"==typeof b&&/^on(\w+)/.test(d)&&w.on(RegExp.$1,b)},a.onreadystatechange=function(){"unknown"!=typeof a.status&&2===a[h]&&k(),4===a[h]&&(v=!1,k(),j(),u(a[h]))},z=["abort","progress"],x=0,y=z.length;y>x;x++)n=z[x],a["on"+n]=function(a){return w.fire(n,b(a))};return p={withCredentials:!1,response:null,status:0},p.addEventListener=function(a,b){return w.on(a,b)},p.removeEventListener=w.off,p.dispatchEvent=function(){},p.open=function(a,b,c){s.method=a,s.url=b,s.async=c,u(1)},p.send=function(b){var c,d,f;s.body=b,f=function(){var b,c,d;t={headers:{}},v=!0,a.open(s.method,s.url,s.async),s.timeout&&(a.timeout=s.timeout),d=s.headers;for(b in d)c=d[b],a.setRequestHeader(b,c);a.send(s.body)},c=l.listeners(e),d=function(){var a,b;if(!c.length)return f();if(a=function(a){return"object"!=typeof a||"number"!=typeof a.status?d():(t=a,u(4),void 0)},b=c.shift(),1===b.length)return a(b(s));if(2===b.length)return b(s,a);throw g},d()},p.abort=function(){v&&a.abort(),w.fire("abort",arguments)},p.setRequestHeader=function(a,b){s.headers[a]=b},p.getResponseHeader=function(a){return t.headers[a]},p.getAllResponseHeaders=function(){return i(t.headers)},p.upload=f(),p},a.xhook=m}(a,b);var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J;for(i=location.protocol+"//"+location.host,z=function(b){var c;return b="xdomain ("+i+"): "+b,c=a.console=a.console||{},c.warn?c.warn(b):alert(b)},H=["postMessage","JSON"],B=0,E=H.length;E>B;B++)if(j=H[B],!a[j])return z("requires '"+j+"' and this browser does not support it"),void 0;for(d="V0",l=function(){return(Math.random()*Math.pow(2,32)).toString(16)},q=function(a){return/(https?:\/\/[^\/]+)(\/.*)?/.test(a)?{origin:RegExp.$1,path:RegExp.$2}:null},y=function(a){var b;return a instanceof RegExp?a:(b=a.toString().replace(/\W/g,function(a){return"\\"+a}).replace(/\\\*/g,".+"),new RegExp("^"+b+"$"))},o=function(c){return b.addEventListener?a.addEventListener("message",c):a.attachEvent("onmessage",c)},u=function(a){return JSON.stringify(a)},k=function(a){return JSON.parse(a)},n=null,f=function(a){var b,c;null===n&&(n={},v());for(b in a)c=a[b],n[b]=c},v=function(){return o(function(a){var b,c,d,e,f,g,h,i,j,l,m,o,p;g="null"===a.origin?"*":a.origin,i=null;for(d in n){l=n[d];try{if(e=y(d),e.test(g)){i=y(l);break}}catch(r){}}if(!i)return z("blocked request from: '"+g+"'"),void 0;if(b=a.source,f=k(a.data),m=f.msg,h=q(m.url),!h||!i.test(h.path))return z("blocked request to path: '"+h.path+"' by regex: "+l),void 0;j=new XMLHttpRequest,j.open(m.method,m.url),j.onreadystatechange=function(){var a;if(4===j.readyState)return a={status:j.status,statusText:j.statusText,type:"",text:j.responseText,headers:xhook.headers(j.getAllResponseHeaders())},b.postMessage(u({id:f.id,msg:a}),g)},m.timeout&&(j.timeout=m.timeout),p=m.headers;for(c in p)o=p[c],j.setRequestHeader(c,o);return j.send(m.body||null)}),a===a.parent?z("slaves must be in an iframe"):a.parent.postMessage("XPING_"+d,"*")},x=null,g=function(a){var b,c;null===x&&(x={},w());for(b in a)c=a[b],x[b]=c},w=function(){return o(function(a){var b;return null!=(b=e.prototype.frames[a.origin])?b.recieve(a):void 0}),xhook.before(function(a,b){var c,d;return d=q(a.url),d&&x[d.origin]?(a.async===!1&&z("sync not supported"),c=new e(d.origin,x[d.origin]),c.send(a,b),void 0):b()})},e=function(){function a(a,c){return this.origin=a,this.proxyPath=c,this.frames[this.origin]?this.frames[this.origin]:(this.frames[this.origin]=this,this.listeners={},this.frame=b.createElement("iframe"),this.frame.id=this.frame.name="xdomain-"+l(),this.frame.src=this.origin+this.proxyPath,this.frame.setAttribute("style","display:none;"),b.body.appendChild(this.frame),this.waits=0,this.waiters=[],this.ready=!1,void 0)}return a.prototype.frames={},a.prototype.post=function(a){this.frame.contentWindow.postMessage(a,this.origin)},a.prototype.listen=function(a,b){if(this.listeners[a])throw"already listening for: "+a;this.listeners[a]=b},a.prototype.unlisten=function(a){delete this.listeners[a]},a.prototype.recieve=function(a){var b,c;return/^XPING(_(V\d+))?$/.test(a.data)?RegExp.$2!==d?(z("your master is not compatible with your slave, check your xdomain.js verison"),void 0):(this.ready=!0,void 0):(c=k(a.data),(b=this.listeners[c.id])?(this.unlisten(c.id),b(c.msg),void 0):(z("unkown message ("+c.id+")"),void 0))},a.prototype.send=function(a,b){var c=this;this.readyCheck(function(){var d;return d=l(),c.listen(d,function(a){return b(a)}),c.post(u({id:d,msg:a}))})},a.prototype.readyCheck=function(a){var b,d=this;return this.ready?a():(this.waiters.push(a),1===this.waiters.length&&(b=function(){if(!d.ready){if(d.waits++>=A.timeout/c)throw"Timeout connecting to iframe: "+d.origin;return setTimeout(b,c)}for(;d.waiters.length;)d.waiters.shift()()},b()),void 0)},a}(),A=function(a){a&&(a.masters&&f(a.masters),a.slaves&&g(a.slaves))},A.parseUrl=q,A.origin=i,A.timeout=15e3,c=100,a.xdomain=A,I=b.getElementsByTagName("script"),C=0,F=I.length;F>C;C++)if(t=I[C],/xdomain/.test(t.src))for(J=["","data-"],D=0,G=J.length;G>D;D++){if(r=J[D],h=t.getAttribute(r+"slave")){if(p=q(h),!p)return;s={},s[p.origin]=p.path,g(s);break}h=t.getAttribute(r+"master"),h&&(m={},m[h]=/./,f(m))}}(a,b),c.parser=a.DOMParser&&new DOMParser;var g,h,i,j,k,l,m,n,o,p,q,r,s;g="accessKeyId",h="secretAccessKey",s={"https://s3.amazonaws.com":"/jpillora-usa/xdomain/proxy.html","https://s3-ap-southeast-2.amazonaws.com":"/jpillora-aus/xdomain/proxy.html"},xdomain({slaves:s}),m=[];for(l in s)m.push(l);k=[],f.hmac_hash=f.sha1,r=function(a,b){return e.base64_encode(e.hstr2astr(f.HMAC(a,b)))},n=function(){return n=function(){},xhook.before(function(a){var b,c,d,e,f,g,h,i,j,l;if(i=xdomain.parseUrl(a.url),i&&i.path&&s[i.origin]){d=null;for(g in k)if(c=k[g],c.path.test(i.path)){d=c;break}if(d){"GET"!==a.method&&(a.headers["Content-Type"]="text/plain; charset=UTF-8"),h=a.headers["Content-Type"],a.headers["x-amz-date"]=(new Date).toUTCString(),b=[],l=a.headers;for(e in l)j=l[e],/^x-amz/i.test(e)&&b.push(e.toLowerCase()+":"+j);f=[a.method,"",h,"",b.join("\n"),i.path].join("\n"),a.headers.Authorization="AWS "+d.access+":"+r(d.secret,f)}}},0),xhook.after(function(a,b){var e,f,g,h,i,j;if(p.xml2json){i=null;for(e in b.headers)/^content-type$/i.test(e)&&(i=e);if(i&&(h=b.headers[i],/\/xml$/.test(h)))try{j=c(b.text),g=d(j),f=JSON.stringify(g,null,2),b.headers[i]="application/json",b.text=f}catch(k){}}})},p=q=function(a,b){return i("DEFAULT",a,b)},j=function(){return i("DEFAULT",access,secret)},i=function(a,b,c,d){null==d&&(d=/.*/),k[a]={access:b,secret:c,path:d},n()},o=function(a){return delete k[a]},p.xml2json=!0,p.set=q,p.clear=j,p.add=i,p.remove=o,p.encoding=e,p.hashing=f,p.endpoints=m,a.s3hook=p}(window,document);