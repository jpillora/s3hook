// S3 Hook - v0.3.0 - https://github.com/jpillora/s3hook
// Jaime Pillora <dev@jpillora.com> - MIT Copyright 2014
!function(a){function b(a){if(b.parser)return b.parser.parseFromString(a,"text/xml");var c=new ActiveXObject("Microsoft.XMLDOM");return c.async=!1,c.loadXML(a),c}function c(a){var b={};if(1==a.nodeType){if(a.attributes.length>0){b["@attributes"]={};for(var d=0;d<a.attributes.length;d++)b["@attributes"][a.attributes[d].nodeName]=a.attributes[d].nodeValue}}else 3==a.nodeType&&(b=a.nodeValue);if(a.hasChildNodes())for(var e=0;e<a.childNodes.length;e++)if("undefined"==typeof b[a.childNodes[e].nodeName])b[a.childNodes[e].nodeName]=c(a.childNodes[e]);else{if("undefined"==typeof b[a.childNodes[e].nodeName].length){var f=b[a.childNodes[e].nodeName];b[a.childNodes[e].nodeName]=[],b[a.childNodes[e].nodeName].push(f)}b[a.childNodes[e].nodeName].push(c(a.childNodes[e]))}var g=!0;for(var h in b)"#text"!==h&&(g=!1);return g?b["#text"]:b}var d={hex:"0123456789abcdef",utf8:"\x00",utf8_table:{},ascii:"\x00\b	\n\f\r !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~Â€ÂÂ‚ÂƒÂ„Â…Â†Â‡ÂˆÂ‰ÂŠÂ‹ÂŒÂÂÂÂÂ‘Â’Â“Â”Â•Â–Â—Â˜Â™ÂšÂ›ÂœÂÂÂŸÂ Â¡Â¢Â£Â¤Â¥Â¦Â§Â¨Â©ÂªÂ«Â¬Â­Â®Â¯Â°Â±Â²Â³Â´ÂµÂ¶Â·Â¸Â¹ÂºÂ»Â¼Â½Â¾Â¿Ã€ÃÃ‚ÃƒÃ„Ã…Ã†Ã‡ÃˆÃ‰ÃŠÃ‹ÃŒÃÃÃÃÃ‘Ã’Ã“Ã”Ã•Ã–Ã—Ã˜Ã™ÃšÃ›ÃœÃÃÃŸÃ Ã¡Ã¢Ã£Ã¤Ã¥Ã¦Ã§Ã¨Ã©ÃªÃ«Ã¬Ã­Ã®Ã¯Ã°Ã±Ã²Ã³Ã´ÃµÃ¶Ã·Ã¸Ã¹ÃºÃ»Ã¼Ã½Ã¾Ã¿",ascii_table:{0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,"\x00":0,"":1,"":2,"":3,"":4,"":5,"":6,"":7,"\b":8,"	":9,"\n":10,"":11,"\f":12,"\r":13,"":14,"":15,"":16,"":17,"":18,"":19,"":20,"":21,"":22,"":23,"":24,"":25,"":26,"":27,"":28,"":29,"":30,"":31," ":32,"!":33,'"':34,"#":35,$:36,"%":37,"&":38,"'":39,"(":40,")":41,"*":42,"+":43,",":44,"-":45,".":46,"/":47,":":58,";":59,"<":60,"=":61,">":62,"?":63,"@":64,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,"[":91,"\\":92,"]":93,"^":94,_:95,"`":96,a:97,b:98,c:99,d:100,e:101,f:102,g:103,h:104,i:105,j:106,k:107,l:108,m:109,n:110,o:111,p:112,q:113,r:114,s:115,t:116,u:117,v:118,w:119,x:120,y:121,z:122,"{":123,"|":124,"}":125,"~":126,"":127,"Â€":128,"Â":129,"Â‚":130,"Âƒ":131,"Â„":132,"Â…":133,"Â†":134,"Â‡":135,"Âˆ":136,"Â‰":137,"ÂŠ":138,"Â‹":139,"ÂŒ":140,"Â":141,"Â":142,"Â":143,"Â":144,"Â‘":145,"Â’":146,"Â“":147,"Â”":148,"Â•":149,"Â–":150,"Â—":151,"Â˜":152,"Â™":153,"Âš":154,"Â›":155,"Âœ":156,"Â":157,"Â":158,"ÂŸ":159,"Â ":160,"Â¡":161,"Â¢":162,"Â£":163,"Â¤":164,"Â¥":165,"Â¦":166,"Â§":167,"Â¨":168,"Â©":169,Âª:170,"Â«":171,"Â¬":172,"Â­":173,"Â®":174,"Â¯":175,"Â°":176,"Â±":177,"Â²":178,"Â³":179,"Â´":180,Âµ:181,"Â¶":182,"Â·":183,"Â¸":184,"Â¹":185,Âº:186,"Â»":187,"Â¼":188,"Â½":189,"Â¾":190,"Â¿":191,Ã€:192,Ã:193,Ã‚:194,Ãƒ:195,Ã„:196,Ã…:197,Ã†:198,Ã‡:199,Ãˆ:200,Ã‰:201,ÃŠ:202,Ã‹:203,ÃŒ:204,Ã:205,Ã:206,Ã:207,Ã:208,Ã‘:209,Ã’:210,Ã“:211,Ã”:212,Ã•:213,Ã–:214,"Ã—":215,Ã˜:216,Ã™:217,Ãš:218,Ã›:219,Ãœ:220,Ã:221,Ã:222,ÃŸ:223,Ã :224,Ã¡:225,Ã¢:226,Ã£:227,Ã¤:228,Ã¥:229,Ã¦:230,Ã§:231,Ã¨:232,Ã©:233,Ãª:234,Ã«:235,Ã¬:236,Ã­:237,Ã®:238,Ã¯:239,Ã°:240,Ã±:241,Ã²:242,Ã³:243,Ã´:244,Ãµ:245,Ã¶:246,"Ã·":247,Ã¸:248,Ã¹:249,Ãº:250,Ã»:251,Ã¼:252,Ã½:253,Ã¾:254,Ã¿:255},base64:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",_searchCharTable:function(a,b){for(var a=a+"",b=b+"",c=0,d=b.length,e=0,f="";e!=(e=c+d>>1);){if(f=(e>>>=0)<b.length?b[e]:"",a==f)return e;a>f?c=e:d=e}return 0},b2h:function(a){var b=this.hex+"",c=a>>4&15,d=15&a;return((c>>>=0)<b.length?b[c]:"0")+((d>>>=0)<b.length?b[d]:"0")},b64c:function(a){return"+"==a||"-"==a?62:"/"==a||"_"==a?63:a>="0"&&"9">=a?+a+52:this._searchCharTable(a,this.base64)},charCode:function(a){var b=this.ascii_table;return 1==a.length&&"Ã¿">=a?b[a]:this._searchCharTable(a,this.utf8)},a2b:function(a){var b=this.ascii_table;return 1==a.length&&"Ã¿">=a?b[a]:0},b2a:function(a){var b=this.ascii+"";return(a>>>=0)<b.length?b[a]:"\x00"},fromCharCode:function(a){var b=this.ascii+"",c=this.utf8+"";return(a>>>=0)<b.length?b[a]:(a>>>=0)<c.length?c[a]:"\x00"},astr2hstr:function(a){var b="",c=0,a=a+"";for(c=0;c<a.length;c++)b+=this.b2h(this.a2b(a[c]));return b},hstr2astr:function(a){var b=0,c=0,d="",e="",f=this.ascii+"",a=a+"";for(b=0;b<a.length;b++)1&b?(c=+("0x"+d+a[b]),e+=(c>>>=0)<f.length?f[c]:"\x00"):d=a[b];return e},utf8_encode:function(a){var b="",c=0,d=0,e="",f=[0,0,0,0],g=[0,0];for(c=0;c<a.length;c++){if(d=this.a2b(e=a[c]),0!=g[0]){if(128>d||d>191){g=[0,0];continue}if(f[g[1]+1-g[0]--&3]=d,g[0])continue;b+=this.fromCharCode(1==g[1]?(31&f[0])<<6|63&f[1]:(15&f[0])<<12|(63&f[1])<<6|63&f[2])}f[0]=d,128>d?b+=e:d>191&&224>d?g=[1,1]:d>=224&&240>d&&(g=[2,2])}return b},utf8_decode:function(a){var b="",c=0,d=0,a=a+"",e=this.b2a(0);for(c=0;c<a.length;c++)d=this.charCode(e=a[c]),b+=128>d?e:2048>d?this.b2a(d>>6|192)+this.b2a(63&d|128):this.b2a(d>>12|224)+this.b2a(128|d>>6&63)+this.b2a(128|63&d);return b},base64_encode:function(a){return this._base64_encode(a,!1)},base64_urlencode:function(a){return this._base64_encode(a,!0)},_base64_encode:function(a,b){var c="",d=0,e=0,a=a+"",f=[0,0],g=b?"":"=",h=this.base64+"0123456789"+(b?"-_":"+/"),i=function(a){return(a>>>=0)<h.length?h[a]:"A"};for(d=0;d<a.length;d++)e=this.a2b(a[d]),d%3==2?(e+=(f[1]<<8)+(f[0]<<16),c+=i(e>>>18&63),c+=i(e>>>12&63),c+=i(e>>>6&63),c+=i(63&e),f=[0,0]):f[d%3&1]=e;return d%3!=0&&(e=(f[1]<<8)+(f[0]<<16),c+=i(e>>>18&63),c+=i(e>>>12&63),c+=d%3==2?i(e>>>6&63):g,c+=g),c},base64_decode:function(a){var a=a+"",b="",c=[0,0,0,0],d=0,e="",f=0;for(0!=(3&a.length)&&(a+="="),d=0;d<a.length&&"="!=(e=a[d]);d++)f=this.b64c(e),3==(3&d)?(f+=(c[2]<<6)+(c[1]<<12)+(c[0]<<18),b+=this.b2a(f>>>16&255),b+=this.b2a(f>>>8&255),b+=this.b2a(255&f),c=[0,0,0,0]):c[d%4&3]=f;return(3&d)>1&&(f=(c[2]<<6)+(c[1]<<12)+(c[0]<<18),b+=this.b2a(f>>>16&255),3==(3&d)&&(b+=this.b2a(f>>>8&255))),b}},e=function(){var a={name:"sha1",identifier:"2b0e03021a",size:20,block:64,hash:function(a){for(var b=(a+="Â€").length,c=b>>6,e=63&b,f="",g=0,h=0,i=[1732584193,4023233417,2562383102,271733878,3285377520],j=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];56!=e++;)a+="\x00",64==e&&(c++,e=0);for(a+="\x00\x00\x00\x00",e=3,b=8*(b-1);e>=0;e--)a+=d.b2a(b>>8*e&255);for(g=0;g<a.length;g++)h=(h<<8)+d.a2b(a[g]),3==(3&g)&&(j[g>>2&15]=h,h=0),63==(63&g)&&this._round(i,j);for(g=0;g<i.length;g++)for(h=3;h>=0;h--)f+=d.b2a(i[g]>>8*h&255);return f},_round:function(a,b){var c=a[0],d=a[1],e=a[2],f=a[3],g=a[4],h=0,i=[1518500249,1859775393,2400959708,3395469782],j=function(a,b){return b<<a|b>>>32-a},k=0,l=function(a,b,c,d){return 20>a?b&c|~b&d:40>a?b^c^d:60>a?b&c|b&d|c&d:b^c^d};for(h=0;80>h;h++)h>=16&&(b[127&h]=j(1,b[h-3&127]^b[h-8&127]^b[h-14&127]^b[h-16&127])),k=j(5,c)+l(h,d,e,f)+g+b[127&h]+i[h/20&3]|0,g=f,f=e,e=j(30,d),d=c,c=k;a[0]=a[0]+c|0,a[1]=a[1]+d|0,a[2]=a[2]+e|0,a[3]=a[3]+f|0,a[4]=a[4]+g|0}},b={name:"sha-256",identifier:"608648016503040201",size:32,block:64,key:[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],hash:function(a){for(var a=a+"Â€",b=a.length,c=b>>6,e=63&b,f="",g=0,h=0,i=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],j=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];56!=e++;)a+="\x00",64==e&&(c++,e=0);for(a+="\x00\x00\x00\x00",e=3,b=8*(b-1);e>=0;e--)a+=d.b2a(b>>8*e&255);for(g=0;g<a.length;g++)h=(h<<8)+d.a2b(a[g]),3==(3&g)&&(j[g>>2&15]=h,h=0),63==(63&g)&&this._round(i,j);for(g=0;g<i.length;g++)for(h=3;h>=0;h--)f+=d.b2a(i[g]>>8*h&255);return f},_round:function(a,b){var c=a[0],d=a[1],e=a[2],f=a[3],g=a[4],h=a[5],i=a[6],j=a[7],k=0,l=0,m=0,n=0;for(k=0;64>k;k++)16>k?n=b[15&k]:(l=b[k+1&15],m=b[k+14&15],n=b[15&k]=(l>>>7^l>>>18^l>>>3^l<<25^l<<14)+(m>>>17^m>>>19^m>>>10^m<<15^m<<13)+b[15&k]+b[k+9&15]|0),n=n+j+(g>>>6^g>>>11^g>>>25^g<<26^g<<21^g<<7)+(i^g&(h^i))+this.key[63&k],j=i,i=h,h=g,g=f+n|0,f=e,e=d,d=c,c=n+(d&e^f&(d^e))+(d>>>2^d>>>13^d>>>22^d<<30^d<<19^d<<10)|0;a[0]=a[0]+c|0,a[1]=a[1]+d|0,a[2]=a[2]+e|0,a[3]=a[3]+f|0,a[4]=a[4]+g|0,a[5]=a[5]+h|0,a[6]=a[6]+i|0,a[7]=a[7]+j|0}};return{sha256:b,sha1:a,SHA256:function(a){return d.astr2hstr(this.sha256.hash(a))},SHA1:function(a){return d.astr2hstr(this.sha1.hash(a))},hmac_hash:b,HMAC:function(a,b){var a=a+"",b=b+"",c=0,e=this.hmac_hash,f=0,g="",h="";for(a.length>e.block&&(a=e.hash(a));a.length<e.block;)a+="\x00";for(c=0;c<a.length;c++)f=d.a2b(a[c]),g+=d.b2a(54^f),h+=d.b2a(92^f);return d.astr2hstr(e.hash(h+e.hash(g+b)))}}}();!function(a,b){!function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t;n=a.document,d="before",c="after",j="readyState",i="addEventListener",h="removeEventListener",g="dispatchEvent",l="XMLHttpRequest",k=["load","loadend","loadstart"],e=["progress","abort","error","timeout"],(t=Array.prototype).indexOf||(t.indexOf=function(a){var b,c,d,e;for(b=d=0,e=this.length;e>d;b=++d)if(c=this[b],c===a)return b;return-1}),r=function(a,b){return Array.prototype.slice.call(a,b)},p=function(a,b){var c,d;for(c in a)if(d=a[c],"returnValue"!==c)try{b[c]=a[c]}catch(e){}return b},q=function(a,b,c){var d,e,f,h;for(e=function(a){return function(d){var e,f,h;e={};for(f in d)"returnValue"!==f&&(h=d[f],e[f]=h===b?c:h);return c[g](a,e)}},f=0,h=a.length;h>f;f++)d=a[f],b["on"+d]=e(d)},o=function(a){var b;if(null!=n.createEventObject)return b=n.createEventObject(),b.type=a,b;try{return new Event(a)}catch(c){return{type:a}}},f=function(a){var c,d,e;return d={},e=function(a){return d[a]||[]},c={},c[i]=function(a,c,f){d[a]=e(a),d[a].indexOf(c)>=0||(f=f===b?d[a].length:f,d[a].splice(f,0,c))},c[h]=function(a,b){var c;c=e(a).indexOf(b),-1!==c&&e(a).splice(c,1)},c[g]=function(){var d,f,g,h,i,j,k,l;for(d=r(arguments),f=d.shift(),a||(d[0]=p(d[0],o(f))),h=c["on"+f],h&&h.apply(b,d),l=e(f).concat(e("*")),g=j=0,k=l.length;k>j;g=++j)i=l[g],i.apply(b,d)},a&&(c.listeners=function(a){return r(e(a))},c.on=c[i],c.off=c[h],c.fire=c[g],c.once=function(a,b){var d;return d=function(){return c.off(a,d),b.apply(null,arguments)},c.on(a,d)},c.destroy=function(){return d={}}),c},s=f(!0),s.EventEmitter=f,s[d]=function(a,b){if(a.length<1||a.length>2)throw"invalid hook";return s[i](d,a,b)},s[c]=function(a,b){if(a.length<2||a.length>3)throw"invalid hook";return s[i](c,a,b)},m=s.headers=function(a,b){var c,d,e,f,g,h;switch(null==b&&(b={}),typeof a){case"object":d=[];for(e in a)f=a[e],d.push(""+e+":	"+f);return d.join("\n");case"string":for(d=a.split("\n"),g=0,h=d.length;h>g;g++)c=d[g],/([^:]+):\s*(.+)/.test(c)&&(b[RegExp.$1]||(b[RegExp.$1]=RegExp.$2));return b}},s[l]=a[l],a[l]=function(){var a,b,h,n,o,r,t,u,v,w,x;return x=new s[l],u=!1,o={},o.headers={},r={},r.headers={},n=function(){var a,b,c;r.status=x.status,r.statusText=x.statusText,c=m(x.getAllResponseHeaders());for(a in c)b=c[a],r.headers[a]||(r.headers[a]=b)},h=function(){try{r.text=x.responseText}catch(a){}try{r.xml=x.responseXML}catch(a){}r.data=x.response||r.text},w=function(){b.status=r.status,b.statusText=r.statusText},v=function(){b.response=r.data||r.text||null,b.responseText=r.text||"",b.responseXML=r.xml||null},a=0,t=function(d){var e,f,h;return e=function(){for(;d>a&&4>a;)b[j]=++a,1===a&&b[g]("loadstart",{}),2===a&&w(),4===a&&(w(),v()),b[g]("readystatechange",{}),4===a&&(b[g]("load",{}),b[g]("loadend",{}))},4>d?(e(),void 0):(f=s.listeners(c),h=function(){var a;return f.length?(a=f.shift(),2===a.length?(a(o,r),h()):3===a.length?a(o,r,h):void 0):e()},h(),void 0)},x.onreadystatechange=function(){try{2===x[j]&&n()}catch(a){}4===x[j]&&(u=!1,n(),h()),t(x[j])},b=o.xhr=f(),b[i]("progress",function(){return t(3)}),q(e,x,b),b.withCredentials=!1,b.response=null,b.status=0,b.open=function(a,b,c,d,e){if(o.method=a,o.url=b,c===!1)throw"sync xhr not supported by XHook";o.user=d,o.pass=e,t(1)},b.send=function(a){var c,e,f,g,h,i,j,k;for(k=["type","timeout"],i=0,j=k.length;j>i;i++)e=k[i],f="type"===e?"responseType":e,o[e]=b[f];o.body=a,h=function(){var a,b,c,d,g,h;for(u=!0,x.open(o.method,o.url,!0,o.user,o.pass),g=["type","timeout"],c=0,d=g.length;d>c;c++)e=g[c],f="type"===e?"responseType":e,x[f]=o[e];h=o.headers;for(a in h)b=h[a],x.setRequestHeader(a,b);x.send(o.body)},c=s.listeners(d),g=function(){var a,b;return c.length?(a=function(a){return"object"!=typeof a||"number"!=typeof a.status&&"number"!=typeof r.status?(g(),void 0):(p(a,r),t(4),void 0)},a.head=function(a){return p(a,r),t(2)},a.progress=function(a){return p(a,r),t(3)},b=c.shift(),1===b.length?a(b(o)):2===b.length?b(o,a):void 0):h()},g()},b.abort=function(){u&&x.abort(),b[g]("abort",{})},b.setRequestHeader=function(a,b){o.headers[a]=b},b.getResponseHeader=function(a){return r.headers[a]},b.getAllResponseHeaders=function(){return m(r.headers)},x.overrideMimeType&&(b.overrideMimeType=function(){return x.overrideMimeType.apply(x,arguments)}),x.upload&&(b.upload=o.upload=f(),q(e.concat(k),x.upload,b.upload)),b},(this.define||Object)((this.exports||this).xhook=s)}(this);var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U;E=null,g=function(a){var b,c;null===E&&(E={},s());for(b in a)c=a[b],E[b]=c},o={},p=function(a,b){var c;return o[a]?o[a]:(c=document.createElement("iframe"),c.id=c.name=q(),c.src=a+b,c.setAttribute("style","display:none;"),document.body.appendChild(c),o[a]=c.contentWindow)},s=function(){return xhook.before(function(a,b){var c,d,e,f;return e=A(a.url),e&&E[e.origin]?(x("proxying request slave: '"+e.origin+"'"),a.async===!1?(K("sync not supported"),b()):(c=p(e.origin,E[e.origin]),f=i(c),f.on("response",function(a){return b(a),f.close()}),a.xhr.addEventListener("abort",function(){return f.emit("abort")}),f.on("xhr-event",function(){return a.xhr.dispatchEvent.apply(null,arguments)}),f.on("xhr-upload-event",function(){return a.xhr.upload.dispatchEvent.apply(null,arguments)}),d=I(a),d.headers=a.headers,(a.body instanceof Uint8Array||a.body instanceof FormData)&&(d.body=a.body),f.emit("request",d),void 0)):(x("no slave matching: '"+e.origin+"'"),b())})},y=null,f=function(a){var b,c;null===y&&(y={},t());for(b in a)c=a[b],y[b]=c},t=function(){return w(function(a,b){var c,d,e,f;"null"===a&&(a="*"),e=null;for(c in y){f=y[c];try{if(d=J(c),d.test(a)){e=J(f);break}}catch(g){}}return e?(b.once("request",function(a){var c,d,g,h,i;if(x("request: "+a.method+" "+a.url),d=A(a.url),!d||!e.test(d.path))return K("blocked request to path: '"+d.path+"' by regex: "+f),b.close(),void 0;h=new XMLHttpRequest,h.open(a.method,a.url),h.addEventListener("*",function(a){return b.emit("xhr-event",a.type,I(a))}),h.upload&&h.upload.addEventListener("*",function(a){return b.emit("xhr-upload-event",a.type,I(a))}),b.once("abort",function(){return h.abort()}),h.onreadystatechange=function(){var a;if(4===h.readyState){a={status:h.status,statusText:h.statusText,data:h.response,headers:xhook.headers(h.getAllResponseHeaders())};try{a.text=h.responseText}catch(c){}return b.emit("response",a)}},a.timeout&&(h.timeout=a.timeout),a.type&&(h.responseType=a.type),i=a.headers;for(c in i)g=i[c],h.setRequestHeader(c,g);h.send(a.body||null)}),x("slave listening for requests on socket: "+b.id),void 0):(K("blocked request from: '"+a+"'"),void 0)}),a===a.parent?K("slaves must be in an iframe"):a.parent.postMessage("XDPING_"+d,"*")},z=function(b){return document.addEventListener?a.addEventListener("message",b):a.attachEvent("onmessage",b)},r=null,G={},u=!0,e="XD_CHECK",H=function(){return z(function(a){var c,d,e,f;if(c=a.data,"string"==typeof c){if(/^XPING_/.test(c))return K("your master is not compatible with your slave, check your xdomain.js verison");if(/^xdomain-/.test(c))c=c.split(",");else try{c=JSON.parse(c)}catch(g){return}}if(c instanceof Array&&(e=c.shift(),/^xdomain-/.test(e)&&(f=G[e],null!==f))){if(f===b){if(!r)return;f=k(e,a.source),r(a.origin,f)}d="string"==typeof c[1]?": '"+c[1]+"'":"",x("receive socket: "+e+": '"+c[0]+"'"+d),f.fire.apply(f,c)}})},k=function(a,b){var d,f,g,h,i,j;return i=!1,j=G[a]=xhook.EventEmitter(!0),j.id=a,j.once("close",function(){return j.destroy(),j.close()}),h=[],j.emit=function(){var b,c;b=F(arguments),c="string"==typeof b[1]?": '"+b[1]+"'":"",x("send socket: "+a+": "+b[0]+c),b.unshift(a),i?g(b):h.push(b)},g=function(a){u&&(a=JSON.stringify(a)),b.postMessage(a,"*")},j.close=function(){j.emit("close"),x("close socket: "+a),G[a]=null},j.once(e,function(b){for(u="string"==typeof b,i=!0,x("ready socket: "+a);h.length;)g(h.shift())}),f=0,d=function(){b.postMessage([a,e,i,{}],"*"),i||(f++===L.timeout/c?K("Timeout waiting on iframe socket"):setTimeout(d,c))},setTimeout(d),x("new socket: "+a),j},i=function(a){var b;return b=k(q(),a)},w=function(a){r=a},l=location.protocol+"//"+location.host,q=function(){return"xdomain-"+Math.round(Math.random()*Math.pow(2,32)).toString(16)},F=function(a,b){return Array.prototype.slice.call(a,b)},C=function(a){return"xdomain ("+l+"): "+a},j=a.console||{},x=function(a){L.debug&&(a=C(a),"log"in j&&j.log(a))},K=function(a){a=C(a),"warn"in j?j.warn(a):alert(a)},S=["postMessage","JSON"];for(M=0,P=S.length;P>M;M++)if(m=S[M],!a[m])return K("requires '"+m+"' and this browser does not support it"),void 0;for(d="V1",A=function(a){return/(https?:\/\/[^\/\?]+)(\/.*)?/.test(a)?{origin:RegExp.$1,path:RegExp.$2}:(x("failed to parse url: "+a),null)},J=function(a){var b;return a instanceof RegExp?a:(b=a.toString().replace(/\W/g,function(a){return"\\"+a}).replace(/\\\*/g,".+"),new RegExp("^"+b+"$"))},I=function(a){var b,c,d,e;b={};for(c in a)"returnValue"!==c&&(d=a[c],"function"!=(e=typeof d)&&"object"!==e&&(b[c]=d));return b},L=function(a){a&&(a.masters&&f(a.masters),a.slaves&&g(a.slaves))},L.debug=!1,L.masters=f,L.slaves=g,L.parseUrl=A,L.origin=l,L.timeout=15e3,c=100,a.xdomain=L,h={slave:function(a){var b,c;return(b=A(a))?(c={},c[b.origin]=b.path,g(c)):void 0},master:function(a){var b;if(a)return b={},b[a]=/./,f(b)},debug:function(a){return"string"==typeof a?L.debug="false"!==a:void 0}},T=document.getElementsByTagName("script"),N=0,Q=T.length;Q>N;N++)if(D=T[N],/xdomain/.test(D.src))for(U=["","data-"],O=0,R=U.length;R>O;O++){B=U[O];for(v in h)n=h[v],n(D.getAttribute(B+v))}H()}(this),b.parser=a.DOMParser&&new DOMParser;var f,g,h,i,j,k,l,m,n,o,p,q,r;f="accessKeyId",g="secretAccessKey",r={"https://s3.amazonaws.com":"/jpillora-usa/xdomain/0.6/proxy.html","https://s3-ap-southeast-2.amazonaws.com":"/jpillora-aus/xdomain/0.6/proxy.html"},xdomain({slaves:r}),j=[],e.hmac_hash=e.sha1,q=function(a,b){return d.base64_encode(d.hstr2astr(e.HMAC(a,b)))},l=function(){return l.d=!0,xhook.before(function(a){var b,c,d,e,f,g,h,i,l,m,n,o;if(m=xdomain.parseUrl(a.url),m&&m.path&&r[m.origin]){d=null;for(g in j)if(c=j[g],c.path.test(m.path)){d=c;break}if(d){h="",/https?:\/\/(([^\.]+)\.)s3[\w-]*\.amazonaws.com/.test(m.origin)&&(h+="/"+RegExp.$2),h+=m.path,l=k(a.headers),i=l?a.headers[l]:a.body?a.headers["Content-Type"]="text/plain; charset=UTF-8":"",i=i.replace(/utf-/,"UTF-"),a.headers["x-amz-date"]=(new Date).toUTCString(),b=[],o=a.headers;for(e in o)n=o[e],/^x-amz/i.test(e)&&b.push(e.toLowerCase()+":"+n);f=[a.method,"",i,"",b.join("\n"),h].join("\n"),a.headers.Authorization="AWS "+d.access+":"+q(d.secret,f)}}},0),xhook.after(function(a,d){var e,f,g,h,i;if(o.xml2json&&(h=k(d.headers),h&&(g=d.headers[h],/\/xml$/.test(g))))try{i=b(d.text),f=c(i),e=JSON.stringify(f,null,2),d.headers[h]="application/json",d.text=e}catch(j){}})},l.d=!1,k=function(a){var b;for(b in a)if(/^content-type$/i.test(b))return b},o=p=function(a,b){return h("DEFAULT",a,b)},i=function(){return h("DEFAULT",null,null)},h=function(a,b,c,d){null==d&&(d=/.*/),j[a]={access:b,secret:c,path:d},l.d||l()},n=function(a){return delete j[a]},m=function(a){var b;return b=xdomain.parseUrl(a),b&&b.path?(r[b.origin]=b.path,xdomain({slaves:r})):void 0},o.xml2json=!0,o.set=p,o.clear=i,o.add=h,o.remove=n,o.encoding=d,o.hashing=e,o.proxy=m,o.endpoints=function(){var a,b;a=[];for(b in r)a.push(b);return a},a.s3hook=o}(this);